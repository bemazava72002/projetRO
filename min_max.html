<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algorithme de Demoucron - Minimisation & Maximisation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vis-network@9.1.2/standalone/umd/vis-network.min.js"></script>
    <style>
        .matrix-table { font-size: 0.9em; margin: 10px 0; }
        .step-container { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .path-info { background-color: #f8f9fa; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .infinity { color: #666; font-style: italic; }
        .changed-cell { background-color: #fff3cd !important; }
    </style>
</head>
<body class="container mt-4">

    <h2 class="text-center mb-4">Algorithme de Demoucron - Minimisation & Maximisation</h2>

    <div class="row">
        <div class="col-md-6">
            <h4>Configuration :</h4>
            <div class="mb-3">
                <label class="form-label">Mode :</label>
                <select id="modeSelect" class="form-select">
                    <option value="min">Minimisation (Plus courts chemins)</option>
                    <option value="max">Maximisation (Plus longs chemins)</option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">Ajouter un sommet :</label>
                <div class="input-group">
                    <input type="text" id="sommetInput" class="form-control" placeholder="Nom du sommet" onkeypress="if(event.key==='Enter') ajouterSommet()">
                    <button class="btn btn-primary" onclick="ajouterSommet()">Ajouter</button>
                </div>
            </div>

            <div class="mb-3">
                <h5>Sommets :</h5>
                <div id="sommetsList" class="d-flex flex-wrap gap-2"></div>
            </div>

            <div class="mb-3">
                <h5>Ajouter un arc :</h5>
                <div class="row g-2">
                    <div class="col">
                        <select id="arcDepart" class="form-select">
                            <option value="">D√©part</option>
                        </select>
                    </div>
                    <div class="col">
                        <select id="arcArrivee" class="form-select">
                            <option value="">Arriv√©e</option>
                        </select>
                    </div>
                    <div class="col">
                        <input type="number" id="arcValeur" class="form-control" placeholder="Poids" onkeypress="if(event.key==='Enter') ajouterArc()">
                    </div>
                    <div class="col-auto">
                        <button class="btn btn-success" onclick="ajouterArc()">Ajouter</button>
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <h5>Arcs :</h5>
                <div id="arcList" class="border rounded p-2" style="max-height: 200px; overflow-y: auto;"></div>
            </div>

            <div class="d-grid gap-2">
                <button class="btn btn-danger btn-lg" onclick="executerDemoucron()">üöÄ Lancer l'algorithme</button>
                <button class="btn btn-warning" onclick="reinitialiser()">üîÑ R√©initialiser</button>
            </div>
        </div>

        <div class="col-md-6">
            <h4>Graphe :</h4>
            <div id="graphContainer" style="height: 400px; border: 1px solid #ddd; border-radius: 5px;"></div>
            
            <div class="mt-3">
                <h5>Recherche de chemin :</h5>
                <div class="row g-2">
                    <div class="col">
                        <select id="cheminDepart" class="form-select">
                            <option value="">Sommet d√©part</option>
                        </select>
                    </div>
                    <div class="col">
                        <select id="cheminArrivee" class="form-select">
                            <option value="">Sommet arriv√©e</option>
                        </select>
                    </div>
                    <div class="col-auto">
                        <button class="btn btn-info" onclick="afficherChemin()">Voir chemin</button>
                    </div>
                </div>
                <div id="cheminInfo" class="path-info mt-2" style="display: none;"></div>
            </div>
        </div>
    </div>

    <div id="resultats" style="display: none;">
        <hr class="my-4">
        <h3>R√©sultats de l'algorithme</h3>
        
        <div id="matrices" class="mb-4"></div>
        
        <div class="row">
            <div class="col-md-6">
                <h4>Matrice des distances finales :</h4>
                <div id="matriceFinale"></div>
            </div>
            <div class="col-md-6">
                <h4>Matrice des pr√©d√©cesseurs :</h4>
                <div id="matricePredecesseurs"></div>
            </div>
        </div>
    </div>

    <script>
        let sommets = [];
        let arcs = [];
        let matrice = [];
        let next = [];
        let network = null;
        let matriceFinaleGlobale = [];

        function ajouterSommet() {
            const nom = document.getElementById("sommetInput").value.trim().toUpperCase();
            if (nom && !sommets.includes(nom)) {
                sommets.push(nom);
                document.getElementById("sommetInput").value = "";
                mettreAJourInterface();
                dessinerGraphe();
            } else if (sommets.includes(nom)) {
                alert("Ce sommet existe d√©j√† !");
            }
        }

        function mettreAJourInterface() {
            // Mise √† jour des listes de s√©lection
            const selects = ["arcDepart", "arcArrivee", "cheminDepart", "cheminArrivee"];
            selects.forEach(id => {
                const select = document.getElementById(id);
                const currentValue = select.value;
                select.innerHTML = `<option value="">${id.includes('arc') ? (id.includes('Depart') ? 'D√©part' : 'Arriv√©e') : (id.includes('Depart') ? 'Sommet d√©part' : 'Sommet arriv√©e')}</option>`;
                sommets.forEach(s => {
                    select.innerHTML += `<option value="${s}">${s}</option>`;
                });
                if (sommets.includes(currentValue)) select.value = currentValue;
            });

            // Affichage des sommets
            const sommetsList = document.getElementById("sommetsList");
            sommetsList.innerHTML = "";
            sommets.forEach((s, index) => {
                sommetsList.innerHTML += `
                    <span class="badge bg-primary me-1">
                        ${s} <button class="btn-close btn-close-white ms-1" style="font-size: 0.7em;" onclick="supprimerSommet(${index})"></button>
                    </span>`;
            });
        }

        function supprimerSommet(index) {
            const sommet = sommets[index];
            arcs = arcs.filter(arc => arc.depart !== sommet && arc.arrivee !== sommet);
            sommets.splice(index, 1);
            mettreAJourInterface();
            afficherArcs();
            dessinerGraphe();
        }

        function ajouterArc() {
            const depart = document.getElementById("arcDepart").value;
            const arrivee = document.getElementById("arcArrivee").value;
            const poids = parseFloat(document.getElementById("arcValeur").value);
            
            if (!depart || !arrivee) {
                alert("Veuillez s√©lectionner les sommets de d√©part et d'arriv√©e !");
                return;
            }
            if (isNaN(poids)) {
                alert("Veuillez entrer un poids valide !");
                return;
            }
            if (depart === arrivee) {
                alert("Un arc ne peut pas partir et arriver au m√™me sommet !");
                return;
            }

            // V√©rifier si l'arc existe d√©j√†
            const arcExistant = arcs.find(arc => arc.depart === depart && arc.arrivee === arrivee);
            if (arcExistant) {
                if (confirm(`Un arc ${depart} ‚Üí ${arrivee} existe d√©j√† avec le poids ${arcExistant.poids}. Voulez-vous le remplacer par ${poids} ?`)) {
                    arcExistant.poids = poids;
                }
            } else {
                arcs.push({ depart, arrivee, poids });
            }
            
            document.getElementById("arcValeur").value = "";
            afficherArcs();
            dessinerGraphe();
        }

        function afficherArcs() {
            const list = document.getElementById("arcList");
            if (arcs.length === 0) {
                list.innerHTML = "<em class='text-muted'>Aucun arc d√©fini</em>";
                return;
            }
            
            list.innerHTML = "";
            arcs.forEach((arc, index) => {
                list.innerHTML += `
                    <div class="d-flex justify-content-between align-items-center border-bottom py-1">
                        <span><strong>${arc.depart}</strong> ‚Üí <strong>${arc.arrivee}</strong> : ${arc.poids}</span>
                        <button class="btn btn-sm btn-outline-danger" onclick="supprimerArc(${index})">√ó</button>
                    </div>`;
            });
        }

        function supprimerArc(index) {
            arcs.splice(index, 1);
            afficherArcs();
            dessinerGraphe();
        }

        function dessinerGraphe() {
            if (sommets.length === 0) return;

            const nodes = sommets.map(s => ({ id: s, label: s }));
            const edges = arcs.map(arc => ({
                from: arc.depart,
                to: arc.arrivee,
                label: arc.poids.toString(),
                arrows: 'to',
                color: { color: '#2B7CE9' }
            }));

            const data = { nodes: new vis.DataSet(nodes), edges: new vis.DataSet(edges) };
            const options = {
                physics: { stabilization: false },
                layout: { randomSeed: 2 }
            };

            const container = document.getElementById('graphContainer');
            network = new vis.Network(container, data, options);
        }

        function initialiserMatrice(mode) {
            const n = sommets.length;
            const valeurInfinie = mode === "min" ? Infinity : -Infinity;
            
            matrice = Array.from({ length: n }, () => Array(n).fill(valeurInfinie));
            next = Array.from({ length: n }, () => Array(n).fill(null));

            // Distances nulles pour les diagonales
            for (let i = 0; i < n; i++) {
                matrice[i][i] = 0;
                next[i][i] = i;
            }

            // Arcs directs
            arcs.forEach(arc => {
                const i = sommets.indexOf(arc.depart);
                const j = sommets.indexOf(arc.arrivee);
                matrice[i][j] = arc.poids;
                next[i][j] = j;
            });
        }

        function executerDemoucron() {
            if (sommets.length === 0) {
                alert("Veuillez ajouter au moins un sommet !");
                return;
            }

            const mode = document.getElementById("modeSelect").value;
            initialiserMatrice(mode);
            
            const n = sommets.length;
            let D = JSON.parse(JSON.stringify(matrice));
            let etapes = [];

            // Matrice initiale
            etapes.push({
                titre: "Matrice initiale",
                matrice: JSON.parse(JSON.stringify(D)),
                k: -1
            });

            // Algorithme de Floyd-Warshall (Demoucron)
            for (let k = 0; k < n; k++) {
                let changements = [];
                for (let i = 0; i < n; i++) {
                    for (let j = 0; j < n; j++) {
                        if (i === j) continue; // Skip diagonal
                        
                        const direct = D[i][j];
                        const valeurInfinie = mode === "min" ? Infinity : -Infinity;
                        
                        // V√©rifier si on peut passer par k
                        if (D[i][k] !== valeurInfinie && D[k][j] !== valeurInfinie) {
                            const viaK = D[i][k] + D[k][j];
                            let nouveau;
                            
                            if (mode === "min") {
                                nouveau = Math.min(direct, viaK);
                            } else {
                                nouveau = Math.max(direct, viaK);
                            }
                            
                            if (nouveau !== direct) {
                                D[i][j] = nouveau;
                                next[i][j] = next[i][k];
                                changements.push({ i, j, ancien: direct, nouveau });
                            }
                        }
                    }
                }
                
                etapes.push({
                    titre: `√âtape ${k + 1} - Via sommet ${sommets[k]}`,
                    matrice: JSON.parse(JSON.stringify(D)),
                    k: k,
                    changements
                });
            }

            // Sauvegarder la matrice finale pour la reconstruction des chemins
            matriceFinaleGlobale = JSON.parse(JSON.stringify(D));
            afficherResultats(etapes, mode);
        }

        function afficherResultats(etapes, mode) {
            const container = document.getElementById("matrices");
            container.innerHTML = "";

            etapes.forEach((etape, index) => {
                const div = document.createElement("div");
                div.className = "step-container";
                div.innerHTML = `
                    <h5>${etape.titre}</h5>
                    ${creerTableauMatrice(etape.matrice, mode, etape.changements || [])}
                `;
                container.appendChild(div);
            });

            // Matrices finales
            document.getElementById("matriceFinale").innerHTML = creerTableauMatrice(etapes[etapes.length - 1].matrice, mode);
            document.getElementById("matricePredecesseurs").innerHTML = creerTableauNext();
            
            document.getElementById("resultats").style.display = "block";
        }

        function creerTableauMatrice(mat, mode, changements = []) {
            const valeurInfinie = mode === "min" ? Infinity : -Infinity;
            let html = `<table class="table table-bordered matrix-table table-sm">
                <thead><tr><th></th>`;
            
            sommets.forEach(s => html += `<th class="text-center">${s}</th>`);
            html += `</tr></thead><tbody>`;

            sommets.forEach((s, i) => {
                html += `<tr><th>${s}</th>`;
                sommets.forEach((t, j) => {
                    const valeur = mat[i][j];
                    const estChange = changements.some(c => c.i === i && c.j === j);
                    const classe = estChange ? "changed-cell" : "";
                    
                    if (valeur === valeurInfinie) {
                        html += `<td class="text-center ${classe} infinity">‚àû</td>`;
                    } else {
                        html += `<td class="text-center ${classe}">${valeur}</td>`;
                    }
                });
                html += `</tr>`;
            });

            return html + `</tbody></table>`;
        }

        function creerTableauNext() {
            let html = `<table class="table table-bordered matrix-table table-sm">
                <thead><tr><th></th>`;
            
            sommets.forEach(s => html += `<th class="text-center">${s}</th>`);
            html += `</tr></thead><tbody>`;

            sommets.forEach((s, i) => {
                html += `<tr><th>${s}</th>`;
                sommets.forEach((t, j) => {
                    const valeur = next[i][j];
                    const affichage = valeur !== null ? sommets[valeur] : "-";
                    html += `<td class="text-center">${affichage}</td>`;
                });
                html += `</tr>`;
            });

            return html + `</tbody></table>`;
        }

        function afficherChemin() {
            const depart = document.getElementById("cheminDepart").value;
            const arrivee = document.getElementById("cheminArrivee").value;
            
            if (!depart || !arrivee) {
                alert("Veuillez s√©lectionner les sommets de d√©part et d'arriv√©e !");
                return;
            }

            if (next.length === 0) {
                alert("Veuillez d'abord ex√©cuter l'algorithme !");
                return;
            }

            const i = sommets.indexOf(depart);
            const j = sommets.indexOf(arrivee);
            const mode = document.getElementById("modeSelect").value;
            
            const chemin = construireChemin(i, j);
            const distance = matriceFinaleGlobale[i][j];
            
            const cheminInfo = document.getElementById("cheminInfo");
            if (chemin.length === 0 || distance === (mode === "min" ? Infinity : -Infinity)) {
                cheminInfo.innerHTML = `<strong>Aucun chemin trouv√©</strong> de ${depart} vers ${arrivee}`;
            } else {
                const cheminTexte = chemin.map(idx => sommets[idx]).join(" ‚Üí ");
                cheminInfo.innerHTML = `
                    <strong>Chemin ${mode === 'min' ? 'le plus court' : 'le plus long'} :</strong><br>
                    ${cheminTexte}<br>
                    <strong>Distance totale :</strong> ${distance === Infinity || distance === -Infinity ? "‚àû" : distance}
                `;
            }
            cheminInfo.style.display = "block";
        }

        function construireChemin(i, j) {
            if (i === j) return [i];
            if (next[i][j] === null) return [];
            
            const chemin = [i];
            let current = i;
            const visite = new Set();
            
            while (current !== j) {
                if (visite.has(current)) return []; // D√©tection de cycle
                visite.add(current);
                
                current = next[current][j];
                if (current === null || current === undefined) return [];
                chemin.push(current);
                
                if (chemin.length > sommets.length + 1) return []; // S√©curit√©
            }
            
            return chemin;
        }

        function reinitialiser() {
            if (confirm("√ätes-vous s√ªr de vouloir tout r√©initialiser ?")) {
                sommets = [];
                arcs = [];
                matrice = [];
                next = [];
                matriceFinaleGlobale = [];
                
                document.getElementById("sommetInput").value = "";
                document.getElementById("arcValeur").value = "";
                document.getElementById("resultats").style.display = "none";
                document.getElementById("cheminInfo").style.display = "none";
                
                mettreAJourInterface();
                afficherArcs();
                
                const container = document.getElementById('graphContainer');
                container.innerHTML = "";
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            mettreAJourInterface();
        });
    </script>
</body>
</html>